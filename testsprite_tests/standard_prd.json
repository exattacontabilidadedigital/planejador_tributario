{
  "meta": {
    "project": "Planejador Tributário v3.0",
    "date": "2025-11-12",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "Planejador Tributário v3.0 é uma solução moderna para planejamento tributário brasileiro que automatiza o cálculo de impostos como ICMS, PIS/COFINS e IRPJ/CSLL, oferece demonstração de resultados (DRE) dinâmica e gestão inteligente de despesas operacionais, permitindo múltiplos cenários de simulação e relatórios profissionais em PDF.",
  "core_goals": [
    "Fornecer cálculos precisos e automáticos dos principais tributos brasileiros.",
    "Permitir gerenciamento e comparação de múltiplos cenários tributários.",
    "Gerar DRE detalhada incluindo despesas com e sem crédito fiscal.",
    "Oferecer memórias de cálculo detalhadas para ICMS, PIS/COFINS e IRPJ/CSLL.",
    "Exportar relatórios e comparações em formato PDF profissional.",
    "Garantir usabilidade com interface moderna, tema dark/light e persistência local dos dados."
  ],
  "key_features": [
    "Cálculo automático dos impostos ICMS, PIS/COFINS e IRPJ/CSLL com suporte a regimes especiais e substituição tributária.",
    "Demonstração do Resultado do Exercício (DRE) dinâmica com indicadores financeiros e margens.",
    "Gerenciamento e salvamento de múltiplos cenários para simulação e comparação de estratégias tributárias.",
    "Memórias de cálculo detalhadas para visualização e validação dos impostos calculados.",
    "Importação de despesas via CSV para apoiar o cálculo correto de créditos fiscais.",
    "Exportação de relatórios completos em PDF, incluindo gráficos e resumo executivo.",
    "Interface moderna baseada em React, Next.js, Tailwind CSS e shadcn/ui com tema dark/light.",
    "Validações automáticas de entradas financeiras e formatos, com feedback visual claro.",
    "Persistência local dos dados no navegador para uso offline e continuidade entre sessões.",
    "Performance otimizada com memoização, debounce e lazy loading."
  ],
  "user_flow_summary": [
    "Usuário acessa a aplicação via navegador suportado e visualiza o dashboard principal.",
    "Configura valor de receita bruta, CMV e alíquotas na aba Configurações iniciais.",
    "Adiciona ou importa despesas operacionais com e sem crédito fiscal nas memórias de cálculo.",
    "Cria e salva cenários tributários diferentes para comparação futura.",
    "Visualiza e compara cenários com análises gráficas e tabelas detalhadas.",
    "Consulta a DRE dinâmica para entender impacto tributário e financeiro em cada cenário.",
    "Exporta relatórios e comparativos em PDF para análise ou apresentação externa.",
    "Utiliza o toggle no header para alterar entre temas dark e light conforme preferência.",
    "Os dados são salvos automaticamente localmente evitando perda e permitindo uso offline."
  ],
  "validation_criteria": [
    "Cálculos de impostos reflexivos das alíquotas configuradas e atualizadas corretamente.",
    "Validação das entradas financeiras com realce para campos obrigatórios e formatos incorretos.",
    "Importação CSV realiza parsing correto e popula os dados de despesas com fidelidade.",
    "Persistência local funciona para manter estado entre sessões e reinicializações.",
    "Interface responde corretamente a mudanças de tema e mantém acessibilidade.",
    "Geração de PDF inclui todos os dados configurados e apresenta-se no layout esperado.",
    "Performance da aplicação mantém tempos de resposta baixos mesmo com dados extensos.",
    "Funções de gerenciamento de cenário permitem criação, renomeação, comparação e exclusão sem erros.",
    "Todos os gráficos e tabelas exibem dados coerentes e atualizados conforme alterações do usuário."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React",
      "Next.js",
      "Supabase",
      "PostgreSQL",
      "Tailwind CSS",
      "Radix UI",
      "shadcn/ui",
      "Chart.js",
      "Recharts",
      "Zustand",
      "Zod"
    ],
    "features": [
      {
        "name": "App Router Pages",
        "description": "Rotas Next.js no diretório app para páginas principais, empresas, comparativos, cenários, relatórios e admin.",
        "files": [
          "src/app/page.tsx",
          "src/app/layout.tsx",
          "src/app/empresas/page.tsx",
          "src/app/empresas/[id]/page.tsx",
          "src/app/empresas/[id]/configuracoes/page.tsx",
          "src/app/empresas/[id]/comparativos/page.tsx",
          "src/app/empresas/[id]/relatorios/page.tsx",
          "src/app/empresas/nova/page.tsx",
          "src/app/admin/migration/page.tsx"
        ]
      },
      {
        "name": "Comparativos Components",
        "description": "UI e lógica para criação, listagem e visualização de análises comparativas com gráficos e exportação.",
        "files": [
          "src/components/comparativos/index.ts",
          "src/components/comparativos/listagem-comparativos.tsx",
          "src/components/comparativos/listagem-dados-comparativos.tsx",
          "src/components/comparativos/filtros-comparativos.tsx",
          "src/components/comparativos/formulario-comparativos.tsx",
          "src/components/comparativos/visualizacao-comparativo.tsx",
          "src/components/comparativos/visualizacao-comparativa.tsx",
          "src/components/comparativos/dashboard-comparativo-completo.tsx",
          "src/components/comparativos/wizard-criar-comparativo-completo.tsx",
          "src/components/comparativos/exportar-pdf.tsx",
          "src/components/comparativos/duplicar-comparativo.tsx",
          "src/components/comparativos/graficos/grafico-carga-tributaria.tsx",
          "src/components/comparativos/graficos/grafico-comparacao-impostos.tsx",
          "src/components/comparativos/graficos/grafico-comparacao-lucros.tsx",
          "src/components/comparativos/graficos/grafico-composicao-impostos.tsx",
          "src/components/comparativos/graficos/grafico-dashboard-comparativo.tsx",
          "src/components/comparativos/graficos/grafico-evolucao-mensal.tsx",
          "src/components/comparativos/graficos/grafico-evolucao-regimes.tsx",
          "src/components/comparativos/graficos/grafico-radar-impostos.tsx",
          "src/components/comparativos/graficos/grafico-waterfall-lucro.tsx",
          "src/components/comparativos/graficos/heatmap-cobertura.tsx"
        ]
      },
      {
        "name": "Relatórios Components",
        "description": "Componentes para relatórios consolidados, métricas financeiras e evolução, com gráficos e exportação.",
        "files": [
          "src/components/relatorios/relatorios-content.tsx",
          "src/components/relatorios/tabela-consolidada.tsx",
          "src/components/relatorios/grafico-composicao.tsx",
          "src/components/relatorios/grafico-evolucao-financeira.tsx",
          "src/components/relatorios/grafico-evolucao.tsx",
          "src/components/relatorios/grafico-margem.tsx",
          "src/components/relatorios/grafico-metricas-financeiras.tsx",
          "src/components/relatorios/botoes-exportacao.tsx"
        ]
      },
      {
        "name": "Memórias de Cálculo",
        "description": "Tabelas de memórias de cálculo de impostos (ICMS, IRPJ/CSLL, PIS/COFINS).",
        "files": [
          "src/components/memoria/memoria-icms-table.tsx",
          "src/components/memoria/memoria-irpj-csll-table.tsx",
          "src/components/memoria/memoria-pis-cofins-table.tsx"
        ]
      },
      {
        "name": "Cenários e Gerenciamento",
        "description": "Gerenciamento de cenários tributários e salvamento de análises.",
        "files": [
          "src/components/scenarios/scenario-manager.tsx",
          "src/components/scenarios/save-scenario-dialog.tsx",
          "src/hooks/use-scenarios.ts",
          "src/hooks/use-cenarios.ts"
        ]
      },
      {
        "name": "Inputs Comuns",
        "description": "Inputs especializados para moeda e porcentagem.",
        "files": [
          "src/components/common/currency-input.tsx",
          "src/components/common/percentage-input.tsx"
        ]
      },
      {
        "name": "UI Base (shadcn/Radix)",
        "description": "Biblioteca de componentes UI reutilizáveis baseada em shadcn/ui e Radix.",
        "files": [
          "src/components/ui/button.tsx",
          "src/components/ui/input.tsx",
          "src/components/ui/dialog.tsx",
          "src/components/ui/dropdown-menu.tsx",
          "src/components/ui/alert-dialog.tsx",
          "src/components/ui/select.tsx",
          "src/components/ui/tabs.tsx",
          "src/components/ui/table.tsx",
          "src/components/ui/toaster.tsx"
        ]
      },
      {
        "name": "Hooks de Cálculo e Dados",
        "description": "Hooks para cálculos tributários, DRE, comparativos e relatórios.",
        "files": [
          "src/hooks/use-tax-calculations.ts",
          "src/hooks/use-dre-calculation.ts",
          "src/hooks/use-comparativos.ts",
          "src/hooks/use-comparativos-calculations.ts",
          "src/hooks/use-relatorios.ts",
          "src/hooks/use-relatorios-simples.ts",
          "src/hooks/use-empresas.ts",
          "src/hooks/use-pdf-export.ts"
        ]
      },
      {
        "name": "Serviços e Integrações",
        "description": "Serviços de análises comparativas e integração com Supabase.",
        "files": [
          "src/services/comparativos-analise-service.ts",
          "src/services/comparativos-analise-service-completo.ts",
          "src/services/memorias-calculo-service.ts",
          "src/services/comparativos-supabase.ts",
          "src/lib/supabase/client.ts",
          "src/lib/supabase/server.ts"
        ]
      },
      {
        "name": "Estado (Zustand)",
        "description": "Stores de estado para cenários, comparativos, empresas, regimes e notificações.",
        "files": [
          "src/stores/cenarios-store.ts",
          "src/stores/comparativos-store.ts",
          "src/stores/comparativos-analise-store.ts",
          "src/stores/empresas-store.ts",
          "src/stores/regimes-tributarios-store.ts",
          "src/stores/notificacoes-store.ts"
        ]
      },
      {
        "name": "Utilitários e Validações",
        "description": "Funções utilitárias, formatadores, constantes e validações (Zod).",
        "files": [
          "src/lib/calcular-impostos.ts",
          "src/lib/formatters.ts",
          "src/lib/constants.ts",
          "src/lib/utils.ts",
          "src/lib/validations.ts",
          "src/lib/validations/cenario.ts"
        ]
      },
      {
        "name": "Tipos",
        "description": "Definições de tipos para cenários, empresas, comparativos e relatórios.",
        "files": [
          "src/types/index.ts",
          "src/types/cenario.ts",
          "src/types/empresa.ts",
          "src/types/comparativo.ts",
          "src/types/comparativo-analise.ts",
          "src/types/comparativo-analise-completo.ts",
          "src/types/relatorio.ts"
        ]
      },
      {
        "name": "Configuração",
        "description": "Configurações do Next.js e Tailwind.",
        "files": [
          "next.config.ts",
          "tailwind.config.ts",
          "postcss.config.js",
          "tsconfig.json"
        ]
      },
      {
        "name": "Migrations Supabase",
        "description": "Scripts SQL para estruturar e migrar o banco de dados no Supabase.",
        "files": [
          "supabase/migrations/20251005_comparativos_analise_completo.sql",
          "supabase/schema.sql",
          "supabase/setup.sql",
          "supabase/05-views.sql"
        ]
      }
    ]
  }
}
